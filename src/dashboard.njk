{% extends "base.njk" %}

{% block content %}
<section class="max-w-3xl mx-auto p-6 mt-10 bg-white rounded shadow">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">üëã Welcome Back</h2>
    <button onclick="signOut()" class="text-red-600 font-medium hover:underline">Sign Out</button>
  </div>

  <p class="text-gray-600 mb-4">Logged in as: <span id="user-email" class="font-medium text-blue-600"></span></p>

  <hr class="my-6" />

  <!-- üìò eBook Generator Form -->
  <div class="mt-6">
    <h3 class="text-xl font-semibold mb-4">üìò Create New eBook</h3>
    <form id="ebook-form" class="grid grid-cols-1 gap-4">
      <!-- Core Info -->
      <input type="text" id="title" name="title" placeholder="eBook Title" class="border px-4 py-2 rounded" required />
      <input type="text" id="topic" name="topic" placeholder="Topic or Subject" class="border px-4 py-2 rounded" />
      <textarea id="description" name="description" placeholder="Describe your eBook content or goal..." rows="3" class="border px-4 py-2 rounded"></textarea>
      <input type="text" id="author_name" name="author_name" placeholder="Author Name" class="border px-4 py-2 rounded" />

      <!-- Basic Settings -->
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
        <select id="audience" name="audience" class="border px-4 py-2 rounded" required>
          <option value="">Select Audience</option>
          <option>Kids</option>
          <option>Teens</option>
          <option>Students</option>
          <option>Parents</option>
          <option>Teachers</option>
          <option>Professionals</option>
          <option>Entrepreneurs</option>
          <option>Freelancers</option>
          <option>Experts</option>
          <option>General Public</option>
          <option>Hobbyists</option>
          <option>Lifelong Learners</option>
        </select>
        <select id="tone" name="tone" class="border px-4 py-2 rounded" required>
          <option value="">Select Tone</option>
          <option>Friendly</option>
          <option>Professional</option>
          <option>Conversational</option>
          <option>Persuasive</option>
          <option>Inspirational</option>
          <option>Humorous</option>
          <option>Casual</option>
          <option>Educational</option>
          <option>Empathetic</option>
          <option>Authoritative</option>
          <option>Story-based</option>
        </select>
        <select id="purpose" name="purpose" class="border px-4 py-2 rounded" required>
          <option value="">Select Purpose</option>
          <option>Informative</option>
          <option>Educational / Tutorial</option>
          <option>Promotional / Affiliate</option>
          <option>Storytelling</option>
          <option>Lead Generation</option>
          <option>Thought Leadership</option>
          <option>Problem-Solving Guide</option>
          <option>Awareness Building</option>
          <option>Entertainment</option>
        </select>
        <select id="language" class="border px-4 py-2 rounded" required>
         <option value="">Select Language</option>
         <option value="English">English</option>
         <option value="Hindi">Hindi</option>
         <option value="Spanish">Spanish</option>
         <option value="French">French</option>
         <option value="German">German</option>
         <option value="Arabic">Arabic</option>
         <option value="Portuguese">Portuguese</option>
         <option value="Indonesian">Indonesian</option>
         <option value="Bengali">Bengali</option>
         <option value="Chinese">Chinese</option>
         </select>
      </div>

      <!-- Extra Options -->
<div class="flex flex-col gap-2">
  <label><input type="checkbox" id="with_images" name="with_images" /> Include Images</label>
  <label><input type="checkbox" id="include_affiliate_links" name="include_affiliate_links" /> Add Affiliate Links Based on Keywords</label>
  <label><input type="checkbox" id="cover_image" name="cover_image" /> Use Cover Image</label>

  <input type="text" id="cover_title" name="cover_title" placeholder="Cover Title (optional)" class="border px-4 py-2 rounded" />
  <input type="file" id="cover_upload" name="cover_upload" accept="image/*" class="border px-4 py-2 rounded" />
  <p class="text-sm text-gray-500">Max upload size: 15MB</p>

 <!-- Extra Options -->
<div class="flex flex-col gap-2">
  <label><input type="checkbox" id="with_images" name="with_images" /> Include Images</label>
  <label><input type="checkbox" id="include_affiliate_links" name="include_affiliate_links" /> Add Affiliate Links Based on Keywords</label>
  <label><input type="checkbox" id="cover_image" name="cover_image" /> Use Cover Image</label>
  
  <input type="text" id="cover_title" name="cover_title" placeholder="Cover Title (optional)" class="border px-4 py-2 rounded" />
  
  <!-- File Upload -->
  <input type="file" id="cover_upload" name="cover_upload" accept="image/*" class="border px-4 py-2 rounded" />
  <p class="text-sm text-gray-500">Max upload size: 10MB</p>

  <!-- Preview Section -->
  <div id="cover-preview-container" class="hidden mt-2 relative w-max">
    <img id="cover-preview" src="" class="rounded shadow w-40 h-auto" alt="Cover Preview" />
    <button type="button" onclick="removeCoverImage()"
      class="absolute -top-2 -right-2 bg-white text-red-500 border border-red-500 rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-500 hover:text-white transition-all"
      title="Remove image">
      √ó
    </button>
    <button id="regenerate-image" class="mt-2 text-sm bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded hidden">
    üñºÔ∏è Regenerate Cover Image Only</button>
  </div>
</div>

      <!-- Pages & Formatting -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <input type="number" id="total_pages" name="total_pages" placeholder="Total Pages" min="10" max="200" class="border px-4 py-2 rounded" required />
        <input type="number" id="font_size" name="font_size" placeholder="Font Size" min="10" max="48" class="border px-4 py-2 rounded" />
        <input type="number" id="headline_size" name="headline_size" placeholder="Headline Size" class="border px-4 py-2 rounded" />
        <input type="number" id="subheadline_size" name="subheadline_size" placeholder="Subheadline Size" class="border px-4 py-2 rounded" />
        <input type="number" id="line_spacing" name="line_spacing" placeholder="Line Spacing" step="0.1" class="border px-4 py-2 rounded" />
        <input type="number" id="paragraph_spacing" name="paragraph_spacing" placeholder="Paragraph Spacing" step="0.1" class="border px-4 py-2 rounded" />
      </div>

      <!-- Margins & Format -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <input type="number" id="margin_top" name="margin_top" placeholder="Top Margin" class="border px-4 py-2 rounded" />
        <input type="number" id="margin_bottom" name="margin_bottom" placeholder="Bottom Margin" class="border px-4 py-2 rounded" />
        <input type="number" id="margin_left" name="margin_left" placeholder="Left Margin" class="border px-4 py-2 rounded" />
        <input type="number" id="margin_right" name="margin_right" placeholder="Right Margin" class="border px-4 py-2 rounded" />
      </div>

      <!-- Layout Options -->
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
        <select id="text_alignment" name="text_alignment" class="border px-4 py-2 rounded">
          <option value="">Text Alignment</option>
          <option>justify</option>
          <option>left</option>
          <option>center</option>
          <option>right</option>
        </select>
        <select id="font_type" name="font_type" class="border px-4 py-2 rounded" required>
          <option value="">Select Font</option>
          <option value="Arial">Arial</option>
          <option value="Open Sans">Open Sans</option>
          <option value="Roboto">Roboto</option>
          <option value="Georgia">Georgia</option>
          <option value="Lato">Lato</option>
          <option value="Times New Roman">Times New Roman</option>
          <option value="Noto Sans">Noto Sans (Best for Multilingual)</option>
        </select>
        <select id="page_size" name="page_size" class="border px-4 py-2 rounded" required>
          <option value="">Select Page Size</option>
          <option value="A4">A4 (210mm √ó 297mm)</option>
          <option value="Letter">US Letter (8.5in √ó 11in)</option>
          <option value="A5">A5 (148mm √ó 210mm)</option>
          <option value="6x9">6√ó9 in (Popular for Kindle & Print-on-Demand)</option>
        </select>
      </div>

      <!-- Preset Save Option -->
      <label class="mt-2">
        <input type="checkbox" id="save_formatting_preset" name="save_formatting_preset" />
        Save this formatting as default for next time
      </label>

      <!-- Submit Button -->
      <button type="submit" class="mt-4 bg-blue-600 text-white py-3 rounded hover:bg-blue-700 transition-all">
        üöÄ Generate eBook
      </button>
    </form>
  </div>
</section>

<!-- ‚úÖ Success Message Box -->
<div id="success-message" class="hidden mt-6 p-4 bg-green-100 text-green-800 rounded shadow">
  ‚úÖ Your eBook has been saved!
  <div class="mt-2 flex flex-wrap gap-4">

    <button onclick="createAnother()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      ‚ûï Create Another
    </button>

    <!-- ‚úÖ These two buttons are now functional, so NOT disabled -->
    <button id="download-pdf" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
      ‚¨áÔ∏è Download PDF
    </button>

   <button id="regenerate-pdf" class="mt-2 text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded hidden">
  üîÑ Regenerate with Tweaks
  </button>

   <button id="send-email" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
      üì© Send to Email
    </button>
  </div>
</div>

<!-- üìÇ Previous eBooks Section -->
<div id="previous-ebooks" class="mt-10 hidden">
  <h3 class="text-xl font-semibold mb-4">üìò Your Generated eBooks</h3>
  <div class="overflow-x-auto">
    <table class="w-full table-auto border text-sm text-left">
      <thead>
        <tr class="bg-gray-100">
          <th class="border px-3 py-2">Title</th>
          <th class="border px-3 py-2">Topic</th>
          <th class="border px-3 py-2">Language</th>
          <th class="border px-3 py-2">Audience</th>
          <th class="border px-3 py-2">Tone</th>
          <th class="border px-3 py-2">Purpose</th>
          <th class="border px-3 py-2">Created</th>
          <th class="border px-3 py-2">Download</th>
        </tr>
      </thead>
      <tbody id="ebook-list">
        <!-- Rows injected by JS -->
      </tbody>
    </table>
  </div>
</div>

<script type="module" src="/description/ebook-form-handler.js"></script>

{% endblock %}

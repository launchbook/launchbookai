  {% extends "base.njk" %}
  
  {% block content %}
  <section class="max-w-3xl mx-auto p-6 mt-10 bg-white rounded shadow">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-800">ğŸ‘‹ Welcome Back</h2>
      <button onclick="signOut()" class="text-red-600 font-medium hover:underline">Sign Out</button>
    </div>
  
    <p class="text-gray-600 mb-4">Logged in as: <span id="user-email" class="font-medium text-blue-600"></span></p>

<div id="user-credits" 
     class="cursor-pointer text-sm text-gray-800 hover:text-blue-600 underline"
     title="Click to view plan details â†’"
     onclick="showMyPlanModal()">
<p class="text-gray-600 mb-4">Available credits: 
    <span id="user-credits" class="font-medium text-green-700">Loading...</span>
  </p>
</div>

<button onclick="showMyPlanModal()" class="text-sm text-blue-600 underline">ğŸ“‹ View My Plan</button>

<!-- Modal -->
<div id="my-plan-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center">
  <div class="bg-white p-6 rounded shadow-lg w-[90%] max-w-md">
    <h2 class="text-lg font-semibold mb-2">ğŸ“‹ My Plan Details</h2>
    <div id="my-plan-content" class="text-sm text-gray-700">
      <!-- Dynamic content inserted here -->
    </div>
    <button onclick="closeMyPlanModal()" class="mt-4 px-3 py-1 bg-blue-600 text-white rounded">Close</button>
  </div>
</div>

    <hr class="my-6" />
  
    <!-- ğŸ“˜ eBook Generator Form -->
    <div class="mt-6">
      <h3 class="text-xl font-semibold mb-4">ğŸ“˜ Create New eBook</h3>
      <form id="ebook-form" class="grid grid-cols-1 gap-4">
        <!-- Core Info -->
        <input type="text" id="title" name="title" placeholder="eBook Title" class="border px-4 py-2 rounded" required />
        <input type="text" id="topic" name="topic" placeholder="Topic or Subject" class="border px-4 py-2 rounded" />
        <textarea id="description" name="description" placeholder="Describe your eBook content or goal..." rows="3" class="border px-4 py-2 rounded"></textarea>
        <input type="text" id="author_name" name="author_name" placeholder="Author Name" class="border px-4 py-2 rounded" />
  
        <!-- Basic Settings -->
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          <select id="audience" name="audience" class="border px-4 py-2 rounded" required>
            <option value="">Select Audience</option>
            <option>Kids</option>
            <option>Teens</option>
            <option>Students</option>
            <option>Parents</option>
            <option>Teachers</option>
            <option>Professionals</option>
            <option>Entrepreneurs</option>
            <option>Freelancers</option>
            <option>Experts</option>
            <option>General Public</option>
            <option>Hobbyists</option>
            <option>Lifelong Learners</option>
          </select>
          <select id="tone" name="tone" class="border px-4 py-2 rounded" required>
            <option value="">Select Tone</option>
            <option>Friendly</option>
            <option>Professional</option>
            <option>Conversational</option>
            <option>Persuasive</option>
            <option>Inspirational</option>
            <option>Humorous</option>
            <option>Casual</option>
            <option>Educational</option>
            <option>Empathetic</option>
            <option>Authoritative</option>
            <option>Story-based</option>
          </select>
          <select id="purpose" name="purpose" class="border px-4 py-2 rounded" required>
            <option value="">Select Purpose</option>
            <option>Informative</option>
            <option>Educational / Tutorial</option>
            <option>Promotional / Affiliate</option>
            <option>Storytelling</option>
            <option>Lead Generation</option>
            <option>Thought Leadership</option>
            <option>Problem-Solving Guide</option>
            <option>Awareness Building</option>
            <option>Entertainment</option>
          </select>
          <select id="language" name="language" class="border px-4 py-2 rounded" required>
          <option value="">Select Language</option>
          <option value="English">English</option>
          <option value="Hindi">Hindi</option>
          <option value="Spanish">Spanish</option>
          <option value="French">French</option>
          <option value="German">German</option>
          <option value="Arabic">Arabic</option>
          <option value="Portuguese">Portuguese</option>
          <option value="Indonesian">Indonesian</option>
          <option value="Bengali">Bengali</option>
          <option value="Chinese">Chinese</option>
          </select>
  
        </div>
  
   <!-- Extra Options -->
  <div class="flex flex-col gap-2">
    <label><input type="checkbox" id="with_images" name="with_images" /> Include Images</label>

   <div id="imageCountContainer" class="mt-3">
  <label for="imageCount" class="block text-sm font-medium text-gray-700">
    Number of Images to Add (0â€“15)
  </label>
  <select id="imageCount" name="imageCount" required
    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
    ${[...Array(16).keys()].map(i => `<option value="${i}">${i}</option>`).join('')}
    </select>
     </div>

    <label><input type="checkbox" id="include_affiliate_links" name="include_affiliate_links" /> Add Affiliate Links Based on Keywords</label>
    <label><input type="checkbox" id="cover_image" name="cover_image" /> Use Cover Image</label>
    
    <input type="text" id="cover_title" name="cover_title" placeholder="Cover Title (optional)" class="border px-4 py-2 rounded" />
    
    <!-- File Upload -->
    <input type="file" id="cover_upload" name="cover_upload" accept="image/*" class="border px-4 py-2 rounded" />
    <p class="text-sm text-gray-500">Max upload size: 10MB</p>
  
    <!-- Preview Section -->
    <div id="cover-preview-container" class="hidden mt-2 relative w-max">
      <img id="cover-preview" src="" class="rounded shadow w-40 h-auto" alt="Cover Preview" />
      <button type="button" onclick="removeCoverImage()"
        class="absolute -top-2 -right-2 bg-white text-red-500 border border-red-500 rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-500 hover:text-white transition-all"
        title="Remove image">
        Ã—
      </button>
      <button id="regenerate-image" class="mt-2 text-sm bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded hidden">
      ğŸ–¼ï¸ Regenerate Cover Image Only</button>
    </div>
  </div>
  
        <!-- Pages & Formatting -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <input type="number" id="total_pages" name="total_pages" placeholder="Total Pages" min="10" max="200" class="border px-4 py-2 rounded" required />
          <input type="number" id="font_size" name="font_size" placeholder="Font Size" min="10" max="48" class="border px-4 py-2 rounded" />
          <input type="number" id="headline_size" name="headline_size" placeholder="Headline Size" class="border px-4 py-2 rounded" />
          <input type="number" id="subheadline_size" name="subheadline_size" placeholder="Subheadline Size" class="border px-4 py-2 rounded" />
          <input type="number" id="line_spacing" name="line_spacing" placeholder="Line Spacing" step="0.1" class="border px-4 py-2 rounded" />
          <input type="number" id="paragraph_spacing" name="paragraph_spacing" placeholder="Paragraph Spacing" step="0.1" class="border px-4 py-2 rounded" />
        </div>
  
        <!-- Margins & Format -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <input type="number" id="margin_top" name="margin_top" placeholder="Top Margin" class="border px-4 py-2 rounded" />
          <input type="number" id="margin_bottom" name="margin_bottom" placeholder="Bottom Margin" class="border px-4 py-2 rounded" />
          <input type="number" id="margin_left" name="margin_left" placeholder="Left Margin" class="border px-4 py-2 rounded" />
          <input type="number" id="margin_right" name="margin_right" placeholder="Right Margin" class="border px-4 py-2 rounded" />
        </div>
  
        <!-- Layout Options -->
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          <select id="text_alignment" name="text_alignment" class="border px-4 py-2 rounded">
            <option value="">Text Alignment</option>
            <option>justify</option>
            <option>left</option>
            <option>center</option>
            <option>right</option>
          </select>
          <select id="font_type" name="font_type" class="border px-4 py-2 rounded" required>
            <option value="">Select Font</option>
            <option value="Arial">Arial</option>
            <option value="Open Sans">Open Sans</option>
            <option value="Roboto">Roboto</option>
            <option value="Georgia">Georgia</option>
            <option value="Lato">Lato</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Noto Sans">Noto Sans (Best for Multilingual)</option>
          </select>
          <select id="page_size" name="page_size" class="border px-4 py-2 rounded" required>
            <option value="">Select Page Size</option>
            <option value="A4">A4 (210mm Ã— 297mm)</option>
            <option value="Letter">US Letter (8.5in Ã— 11in)</option>
            <option value="A5">A5 (148mm Ã— 210mm)</option>
            <option value="6x9">6Ã—9 in (Popular for Kindle & Print-on-Demand)</option>
          </select>
        </div>
  
        <!-- Preset Save Option -->
        <label class="mt-2">
          <input type="checkbox" id="save_formatting_preset" name="save_formatting_preset" />
          Save this formatting as default for next time
        </label>
  
        <!-- Submit Button -->
        <button type="submit" class="mt-4 bg-blue-600 text-white py-3 rounded hover:bg-blue-700 transition-all">
          ğŸš€ Generate eBook
        </button>
      </form>
    </div>
  
  <!-- ğŸ”„ Progress Bar -->
  <div id="progress-bar" class="hidden text-center text-blue-600 mt-4">
    <svg class="animate-spin h-5 w-5 inline-block mr-2" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
    </svg>
    Generating your eBook, please wait...
  </div>
  
  </section>
  
  <!-- âœ… Success Message Box -->
  <div id="success-message" class="hidden mt-6 p-4 bg-green-100 text-green-800 rounded shadow">
    âœ… Your eBook has been saved!
    <div class="mt-2 flex flex-wrap gap-4">
  
  <!-- ğŸ“„ PDF Preview -->
  <div id="pdf-preview" class="hidden mt-6">
    <h4 class="text-lg font-medium mb-2">ğŸ“„ Preview</h4>
    <iframe src="" class="w-full h-96 border rounded shadow"></iframe>
  </div>

    <button onclick="deleteCoverImage()" class="text-red-600 underline mt-2">âŒ Delete Cover</button>

      <button onclick="createAnother()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        â• Create Another
      </button>
  
      <!-- âœ… These two buttons are now functional, so NOT disabled -->

     <p id="credit-estimate-msg" style="margin-top: 10px; font-weight: bold; color: #008000;"> Estimated credits: â€”</p>

      <button id="download-pdf" disabled class="bg-blue-500 text-white px-4 py-2 rounded opacity-60 cursor-not-allowed">
        â¬‡ï¸ Download PDF
      </button>
  
     <button id="regenerate-pdf" class="mt-2 text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded hidden">
    ğŸ”„ Regenerate with Tweaks
    </button>
  
     <button id="send-email" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
        ğŸ“© Send to Email
      </button>
    </div>
  </div>
  
  <!-- ğŸ“‚ Previous eBooks Section -->
  <div id="previous-ebooks" class="mt-10 hidden">
    <h3 class="text-xl font-semibold mb-4">ğŸ“˜ Your Generated eBooks</h3>
    <div class="overflow-x-auto">
      <table class="w-full table-auto border text-sm text-left">
        <thead>
          <tr class="bg-gray-100">
            <th class="border px-3 py-2">Title</th>
            <th class="border px-3 py-2">Topic</th>
            <th class="border px-3 py-2">Language</th>
            <th class="border px-3 py-2">Audience</th>
            <th class="border px-3 py-2">Tone</th>
            <th class="border px-3 py-2">Purpose</th>
            <th class="border px-3 py-2">Created</th>
            <th class="border px-3 py-2">Download</th>
          </tr>
        </thead>
        <tbody id="ebook-list">
          <!-- Rows injected by JS -->
        </tbody>
      </table>
    </div>
  </div>
  
  <script type="module" src="/description/ebook-form-handler.js"></script>
  
  {% endblock %}
